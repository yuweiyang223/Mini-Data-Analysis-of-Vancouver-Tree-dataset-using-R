---
title: "Mini data analysis - Vancouver trees"
author: "Yuwei Yang"
date: "2021/10/5"
output:
  github_document:
    html_preview: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE)
```

Please install the following three packages before running the code. The package datateachr contains 7 data set and we will use 4 of them. The package tidyverse contains the package dplyr and we will use it to do data wrangling. The package ggplot2 is used to do visualization in this analysis. 

```{r}
library(datateachr)
library(tidyverse)
library(ggplot2)
```

# Task 1: Choose the dataset

## 1.1 Choose 4 datasets from datateachr packages:
  1: steam_games: Acquired courtesy of Kaggle. It currently has 40833 rows and 21 columns.
  
  2: flow_sample: Acquired courtesy of The Government of Canada’s Historical Hydrometric Database. It currently has 218 rows and 7 columns.
  
  3: parking_meters: Acquired courtesy of The City of Vancouver’s Open Data Portal. It currently has 10032 rows and 22 columns.
  
  4: cancer_sample: Acquired courtesy of UCI Machine Learning Repository. It currently has 569 rows and 32 columns.

## 1.2 Explore datasets: 

This part, I will check the class of the data using class(), and the number of rows and columns, and the name of each columns with some useful information using glimse(). You may also use ?dataset to get the description and other relative information for this dataset.

The following is the information for steam_games data:
```{r}
class(steam_games)
glimpse(steam_games)
#?steam_games
```
The following is the information  for flow_sample data:

```{r}
class(flow_sample)
glimpse(flow_sample)
```

The following is the information or vancouver_trees data:
```{r}
class(vancouver_trees)
glimpse(vancouver_trees)
```

The following is the information  for cancer_sample data:

```{r}
class(cancer_sample)
glimpse(cancer_sample)
```

# 1.3 Select dataset:

The following are the questions I have for each dataset. 

steam_games: 1. Which developer and publisher receive the most achievements?
2. Does achievements of the game relate to the reviews(both recent and all reviews)?

flow_sample: 1. What the relationship of the flow rate respect with year? 2. What's the most busiest day every week?

Vancouver_trees: 1. For each species, will the height be very different? (use jitter plot/side by side boxplot) 2. Will the root barrier affect the diameter of the tree within each species? 3. Does the plant area relate to the height of the tree? 4. For each neighborhood, how many trees were planted? 

Cancer_sample: For different diagnosis, will the parameters be different? 

I decide to analyze vancouver_trees because I am currently living in vancouver, so I am very interested in the data of this city. Also, the data set seems to have some relationships between each variable. For example, I am interested in weather the diameter of a tree will be affect by other factors.   


# 2: The following four questions are the goal of this analysis:
  1. What's the distribution of number of trees with respect to different height range?
  2. What's the relationship between tree diameter and the age of this tree.
  3. Will this relationship be different of each species? 
  3. Will the root barrier affect the diameter of the tree within each species?
  

# 3. Explore dataset

## 1. The first question I am interested in is what the distribution of number of trees with respect to different height range is.I am going to use ggplot2 to plot the distribution of the number of trees using different height range id.  The height range is is between 0-10 for every 10 feet (e.g., 0 = 0-10 ft, 1 = 10-20 ft, 2 = 20-30 ft, and 10 = 100+ ft).

```{r}
ggplot(vancouver_trees, aes(height_range_id)) +
  geom_histogram(binwidth=1, fill ="pink", alpha=0.8)+
  xlab("Tree Height Range ID")+ylab("Number of Trees")+
  theme_light()
```
## 2. The second question I want to analyze is what's the relationship between tree diameter and the age of this tree. I am going to add a new column named tree_age which is the number of years between the trees were planted and the current date 2021-10-01(round to 2 decimal places) by using dplyr verbs. I will use this tibble later to find the relationship between the age of the tree and the height of the tree. 


```{r}
vancouver_trees <- vancouver_trees %>%
  # Calling difftime() function
  mutate(tree_age = round(as.numeric(difftime("2021-10-01", date_planted, units="days"))/365, 2)) 
  # add tree_age column to vancouver_trees tibble

head(vancouver_trees)
```

3. Next, I am going to find out if there is a relationship between the age of the tree and the diameter of the tree. I will use ggplot2 package to plot the jitter plot. I set the range of diameter to 0 and 50 because I want to get rid of the outliers in the graph, so it is more easier to see. 

```{r}
ggplot(vancouver_trees, aes(tree_age, diameter))+
  geom_jitter(outlier.shape = NA, aes(alpha=0.6, colour=tree_age))+
  coord_cartesian(ylim =  c(0, 50))
```
4. As we can see, from the jitterplot, it seems that the diameter of three tend to be larger as the age getting larger. So, next, I want to analyze this relationship in details by separating the trees into different species and look at the relationship within each species. I will use both dplyr and ggplot2 in this part. Also, I want to plot only those species with more than 5000 trees so we have big enough sample to analyze. You may noticed I set the range of the diameter to 0 and 25 this time is because I want to get rid of the most outliers for these species. 

```{r}
 vancouver_trees%>%
  group_by(species_name) %>%
  filter(n() >5000) %>%
  ggplot(aes(tree_age, diameter))+ 
  geom_point()+  facet_wrap(~species_name)+
  coord_cartesian(ylim =  c(0,35))

```

Again, the diameter of the tree seems to have positive relationship with the age of the tree within each species. And some of species tend of have larger diameter than others such as Serrulata tend to have larger diameter when its age getting older.  

5. And the last thing I can think about is the root barrier might affect the trees' diameter as well. I am going using the same plot above but with different color for each root barrier.  

```{r}
vancouver_trees %>%
  group_by(species_name)%>%
  filter(n()>5000) %>%
  ggplot(aes(tree_age, diameter))+ 
  geom_point(aes(colour=root_barrier))+  facet_wrap(~species_name)+
  coord_cartesian(ylim =  c(0, 35))



```

From the graphs, I don't think the root barrier is affecting the diameter of the trees.

